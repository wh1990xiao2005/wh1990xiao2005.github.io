---
title: 为了安全——应用锁屏开发实战
date: 2016-03-16 15:49:45
tags: Android
categories: 编程世界
---

今天我们来谈一个问题：应用锁屏。  
说老实话，这种设定目前已经被广泛使用了，多见于支付宝、京东金融、QQ等对安全性和隐私性要求较高的程序使用。  
关于该功能的实现，有不止一条解决办法。这里就不一一列举了，只对其中一种做详细解释和示例程序的代码分享。  
这里我声明一下，好像自从写博客到现在，我一直都在用Android Studio为IDE来开发，强烈建议还在使用Eclipse的小伙伴尽快使用它。尽管一上来可能有些许不便，但是上手之后效率会有所提高，不信就去试试！  
本文介绍的方法解决思路如下：

 1. 监听屏幕变化，即关闭和打开屏幕；
 2. 设置需要出现锁屏的标志变量，默认值为false。当接收到屏幕被关闭的广播后，将其置为true。
 3. 在Activity生命周期onResume中，检测上述变量值，若为true，则启动安全校验机制，反之无操作。
 
Demo代码中包含的锁屏机制提供了多种选项，可自由组合实现不同的应用解锁效果。  
## 步骤1 设置监听器 ##
首先我们写一个类，集成BroadcastReceiver，用来接收系统Screen off的Action。这里我才用了Java代码中动态注册监听器的方法，而非xml配置文件，因为这样可以更方便的让我们对监听使能进行控制。由于监听器需要在代码中进行实例化，因此我们可以在监听器相关类中定义布尔变量，来标识是否有了关闭屏幕的操作。代码片段如下所示：  

```
public class LockScreenReceiver extends BroadcastReceiver {

    private boolean isNeedCheck;

    @Override
    public void onReceive(Context context, Intent intent) {
        if (intent.getAction().equals(Intent.ACTION_SCREEN_OFF)) {
        //关闭屏幕
        isNeedCheck = true;
        }
    }

    public void unRegist() {
        isNeedCheck = false;
    }

    public boolean isNeedCheck() {
        return isNeedCheck;
    }
}
```

## 步骤2 动态注册监听器 ##
这一步骤要求我们对监听器进行动态注册，所谓动态注册就是绑定到指定的控件上，由用户自由选择，进行注册和取消注册。  
具体代码见Demo。下面放上Github地址：  
https://github.com/XiaoWenHan/Demo_SafeScreen
